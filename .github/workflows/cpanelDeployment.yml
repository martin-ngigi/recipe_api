name: Publish Website to CPanel

on:
  push:
    branches:
      - main

jobs:
  FTP-Deploy-Action:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 2

      - name: Build assets
        run: |
          npm install
          npm run build

      - name: Install PHP and Composer
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3' # Or '8.2' OR Adjust based on your Laravel version
          tools: composer

      - name: Install Composer dependencies
        run: composer install --no-dev --optimize-autoloader
        
      - name: Debug FTP secrets.
        run: |
          echo "SERVER: ${{ secrets.SERVER }}"
          echo "USERNAME: ${{ secrets.USERNAME }}"

      - name: Deploy to CPanel via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{secrets.server}}
          username: ${{secrets.username}}
          password: ${{secrets.password}}
          server-dir: /public_html/ # Adjust this if deploying to a subdirectory
          local-dir: ./ # Or ./public if only deploying built frontend
          dangerous-clean-slate: false
